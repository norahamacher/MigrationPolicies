{"version":3,"sources":["StoryPanel.js","YearSlider.js","index.js"],"names":["StoryPanel","m_actionFilter","state","visible","id","props","paragraphs","res","i","this","length","push","content","text","actionFilter","setState","className","activeID","chapter","map","paragraph","key","panToFilter","highlightFilter","yearStart","minYear","yearEnd","maxYear","app","Component","StoryParagraph","m_firedAction","m_statusChanged","m_filterArray","handleScroll","event","topOffset","ReactDOM","findDOMNode","getBoundingClientRect","top","bottom","highlighted","updateYears","panToCountry","country","highlightObjects","objects","setActiveID","paragraphChange","isIntersecting","window","removeEventListener","addEventListener","onChange","ReactHtmlParser","MigrationSlider","withStyles","root","color","height","thumb","width","backgroundColor","border","borderRadius","marginTop","marginLeft","boxShadow","active","valueLabel","left","fontSize","background","track","rail","Slider","ScrollyTeller","m_debug","updateDimensions","innerWidth","innerHeight","panelHeight","sections","activeId","pointOfView","autoRotate","highlightCountries","panelChanged","UNSAFE_componentWillMount","sectiondata","renderparagraphs","createPanelContent","year","allPanels","console","log","m_countryLocations","undefined","lat","lon","result","filter","features","j","feature","type","replace","url","actions","action","k","highlight","keywords","cap","panTo","min","max","lower","c","toUpperCase","section","name","title","style","parseInt","NavMenuItem","selector","alignToTop","useState","React","useEffect","useRef","lastPoint","GlobeFunctions","countries","setCountries","hoverD","setHoverD","globeEl","fetch","process","then","response","json","current","lng","altitude","ms","controls","ref","globeImageUrl","polygonsData","d","properties","ISO_A2","polygonAltitude","hasActivePolicyInYear","migrationpolicies","polygonCapColor","indexOf","ADMIN","polygonSideColor","polygonStrokeColor","polygonLabel","getPolicyText","onPolygonHover","polygonsTransitionDuration","policies","start","end","substr","str","render","document","getElementById"],"mappings":"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","file":"static/js/main.e6af2e51.chunk.js","sourcesContent":["import React, { Component } from 'react';\r\nimport ReactDOM from 'react-dom'\r\nimport Observer from '@researchgate/react-intersection-observer';\r\nimport ReactHtmlParser from 'react-html-parser';\r\n\r\nexport default class StoryPanel extends Component {\r\n  //a storypanel is visible whenit enters the viewport until another enters.\r\n  m_actionFilter = null\r\n  state = {\r\n    visible: true,\r\n    id: this.props.id,\r\n    paragraphs: []\r\n  };\r\n\r\n\r\n\r\n\r\n  componentDidMount() {\r\n    var res = [];\r\n    for (var i = 0; i < this.props.paragraphs.length; i++) {\r\n      res.push(\r\n        { \"text\": this.props.paragraphs[i].props.content.text, \"filter\": this.props.paragraphs[i].props.actionFilter }\r\n      )\r\n\r\n\r\n\r\n      this.setState({\r\n        paragraphs: res\r\n      })\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    //   console.log(this.props)\r\n  }\r\n  render() {\r\n\r\n    return (\r\n      <section id={\"section_\" + this.state.id} className={`storyPanelSection ${this.state.visible && this.state.id === this.props.activeID ? 'activePanel' : 'inactivePanel'}`} >\r\n    \r\n\r\n          <h1 id={\"chap_\" + this.props.chapter} className={`sticky sectiontitle`} />\r\n\r\n\r\n\r\n        <div className=\"panelcontent\">\r\n          {this.props.paragraphs.map(\r\n            (paragraph, i) =>\r\n\r\n              <StoryParagraph\r\n                key={\"chap_\" + this.props.chapter + \"_id_p\" + i}\r\n                id={\"chap_\" + this.props.chapter + \"_id_p\" + i}\r\n                paragraph={paragraph.props.content.text}\r\n                panToFilter={paragraph.props.panToFilter}\r\n                highlightFilter={paragraph.props.highlightFilter}\r\n                yearStart={paragraph.props.content.minYear}\r\n                yearEnd={paragraph.props.content.maxYear}\r\n                app={this.props.app}\r\n                id = {this.props.id}\r\n\r\n              />\r\n\r\n          )}\r\n        </div>\r\n\r\n      </section>\r\n\r\n    )\r\n  }\r\n}\r\n\r\nclass StoryParagraph extends Component {\r\n\r\n\r\n  m_firedAction = false\r\n  m_statusChanged = false\r\n\r\n\r\n  m_filterArray = [\"any\", []]\r\n  state = {\r\n    id: this.props.id,\r\n    visible: false\r\n  }\r\n\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('scroll', this.handleScroll);\r\n  };\r\n\r\n\r\n  handleScroll = (event) => {\r\n    //if the element is visible we check where it is on the screen, and highlight it when it enters a threshold, dehighlight when it exits.\r\n    if (this.state.visible) {\r\n      var topOffset = ReactDOM.findDOMNode(this).getBoundingClientRect().top\r\n      var bottomOffset = ReactDOM.findDOMNode(this).getBoundingClientRect().bottom\r\n \r\n      if ((topOffset > 80 && topOffset < 400) ) {\r\n        //if this paragraph has anactionFilter to it, apply it!\r\n        if (!this.state.highlighted) {\r\n          this.setState({\r\n            highlighted: true\r\n          })\r\n          //   console.log(this.props.yearStart)\r\n          this.props.app.updateYears(this.props.yearStart, this.props.yearEnd)\r\n  \r\n            this.props.app.panToCountry(this.props.panToFilter.country)\r\n    \r\n            // this.m_mapFunctions.showAllTypes()\r\n            this.m_firedAction = true;\r\n          \r\n\r\n            this.props.app.highlightObjects(this.props.highlightFilter.objects)\r\n            this.props.app.setActiveID(this.props.id)\r\n          \r\n        }\r\n\r\n\r\n      } else {\r\n\r\n        if (this.state.highlighted) {\r\n          //visible should update...\r\n          this.setState({\r\n            highlighted: false\r\n          })\r\n          //deactivate filter if thereisonw\r\n          this.m_firedAction = false\r\n\r\n        }\r\n\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('scroll', this.handleScroll);\r\n\r\n    //construct the filter if there is one\r\n    /*if (this.props.actionFilter) {\r\n      this.m_filterArray = [\"any\"]\r\n      //create the filter syntax fromthe actionFilter provided\r\n      for (var i = 0; i < this.props.actionFilter.types.length; i++) {\r\n        this.m_filterArray.push([\"==\", [\"get\", \"type\"], this.props.actionFilter.types[i]])\r\n      }\r\n      \r\n     \r\n    }*/\r\n  }\r\n\r\n  //gets called when the element intersects with Observer\r\n  paragraphChange = event => {\r\n    this.setState({\r\n      visible: event.isIntersecting\r\n    })\r\n\r\n  }\r\n\r\n  render() {\r\n    return (\r\n \r\n        <Observer\r\n          onChange={this.paragraphChange}\r\n        >\r\n          <p\r\n            className={`scrolltext ${this.state.highlighted ? \"active\" : \"\"}`}\r\n            id={this.props.id}>\r\n            {ReactHtmlParser(this.props.paragraph)}\r\n\r\n          </p>\r\n        </Observer>\r\n       \r\n   \r\n    )\r\n  }\r\n}","import React, {Component} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { withStyles, makeStyles } from '@material-ui/core/styles';\r\nimport Slider from '@material-ui/core/Slider';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\nexport default class YearSlider extends Component {\r\n\r\n    componentDidMount(){\r\n        console.log(this.props.activeYear)\r\n    }\r\n    changeYear = (event,newValue) => {\r\n        console.log(newValue)\r\n        console.log(this.props)\r\n        this.props.callbackFunction(newValue)\r\n    }\r\n    render(){\r\n        return(\r\n            <MigrationSlider  \r\n            value={this.props.activeYear}\r\n            onChange={this.changeYear} \r\n            valueLabelDisplay={\"on\"} \r\n            defaultValue={2000}\r\n            max={2050} \r\n            min={1900} />\r\n        )\r\n    }\r\n}\r\n\r\n\r\nconst MigrationSlider = withStyles({\r\n    root: {\r\n      color: '#52af77',\r\n      height: 12,\r\n    },\r\n    thumb: {\r\n      height: 24,\r\n      width: 48,\r\n      backgroundColor: '#fff',\r\n      border: '1px solid currentColor',\r\n      borderRadius: 0,\r\n      marginTop: -8,\r\n      marginLeft: -12,\r\n      '&:focus, &:hover, &$active': {\r\n        boxShadow: 'inherit',\r\n      },\r\n    },\r\n    active: {},\r\n    valueLabel: {\r\n     \r\n      top: 5,\r\n      left: 7,\r\n      fontSize: 14,\r\n    '& *': {\r\n      background: 'transparent',\r\n      color: '#000',\r\n    },\r\n      \r\n    \r\n    },\r\n    track: {\r\n      \r\n      height: 8,\r\n      borderRadius: 4,\r\n    },\r\n    rail: {\r\n      height: 8,\r\n      borderRadius: 4,\r\n    },\r\n  })(Slider);","import React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport './css/index.css';\nimport './css/responsive.css'\n//import ReactMapboxGl, { Layer, Feature } from 'react-mapbox-gl';\nimport StoryPanel from './StoryPanel.js'\n//import * as d3 from 'd3'\nimport YearSlider from './YearSlider.js'\n//import MapFunctions from './MapFunctions';\nimport sectiondata from './playdata/sections.json'\nimport ScrollIntoView from 'react-scroll-into-view'\n//import Stackedbarchart from './stacked-bar.js'\n//import GlobeFunctions from './GlobeFunctions.js'\n\nimport * as d3 from 'd3'\nimport Globe from 'react-globe.gl'\nimport { isElementOfType } from 'react-dom/test-utils';\nclass ScrollyTeller extends Component {\n\n\n    m_debug = true\n\n\n    updateDimensions = () => {\n        this.setState({ width: window.innerWidth, height: window.innerHeight, panelHeight: window.innerHeight - 100 });\n\n    };\n\n    //  m_mapfilter = null;\n    state = {\n        sections: [],\n        width: 0,\n        height: 0,\n        //the years should be read from a file with their corresponding html content\n        // sorteddata: [],\n        activeId: 0,\n        panelHeight: 800,\n        minYear: 1945,\n        maxYear: 2020,\n        pointOfView: null,\n        autoRotate: true,\n        highlightCountries: []\n\n    }\n    panelChanged = false\n    // m_mapFunctions = null\n    //\"Facility Name\", \"Status\", \"Region\", \"Technology\", \"Generator Capacity (MW)\", \"Latitude\", \"Longitude\"\n\n\n    UNSAFE_componentWillMount = function () {\n        window.addEventListener('resize', this.updateDimensions);\n        this.updateDimensions()\n        var i\n        for (i = 0; i < sectiondata.sections.length; i++) {\n            sectiondata.sections[i].renderparagraphs = this.createPanelContent(sectiondata.sections[i].year, sectiondata.sections[i].paragraphs)\n\n        }\n        //   console.log(sectiondata.sections[4].renderparagraphs)\n        //read the content from file.\n        this.setState({\n            sections: sectiondata.sections\n        })\n\n        //  console.log(sectiondata.sections)\n\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener('resize', this.updateDimensions);\n    }\n    allPanels = []\n    setActiveID = (id) => {\n             console.log(id)\n        this.setState({\n            activeId: id\n\n        })\n    }\n\n    createPanelContent(year, paragraphs) {\n\n        //read the text from somewhere based on the given year\n        var result = [];\n        \n        var key = \"\"\n        for (var i = 0; i < paragraphs.length; i++) {\n            key = year + \"_\" + i\n            var highlightFilter = {\n                \"objects\": []\n            }\n            var filter = \"\";\n        \n            //check for features like links, if its a link, replace the \"text\" with a hyperlinnk to the \"url\"\n            if (paragraphs[i].features) {\n                for (var j = 0; j < paragraphs[i].features.length; j++) {\n                    var feature = paragraphs[i].features[j]\n                    if (feature.type === \"link\") {\n                        paragraphs[i].text = paragraphs[i].text.replace(feature.text, '<a href=\"' + feature.url + '\" target=\"_blank\">' + feature.text + '</a>')\n                        //                console.log(paragraphs[i].text)\n                    }\n                }\n            }\n            //if actions aredefined, they are added to the element here.\n            if (paragraphs[i].actions) {\n                for (j = 0; j < paragraphs[i].actions.length; j++) {\n                    var action = paragraphs[i].actions[j]\n                    if (action[\"highlight\"] !== undefined) {\n            \n\n                        //highlight means highlight the words in the text with a class of the same name, and filter things on the map of this name\n                        for (var k = 0; k < action.highlight.keywords.length; k++) {\n                       //     console.log(action.highlight.keywords[k])\n                            paragraphs[i].text = paragraphs[i].text.replace(action.highlight.keywords[k], \"<span class='bold'>\" + action.highlight.keywords[k] + \"</span>\")\n                            highlightFilter.objects.push(this.cap(action.highlight.keywords[k]))\n\n                            //capitalise first letter otherwise the filter breaks \n                        }\n                    } \n                    if (action[\"panTo\"] !== undefined) {\n                        filter = {\n                            \"country\": action.panTo\n                        }\n                    } \n                }\n\n            }\n            result.push(\n                <div content={paragraphs[i]} id={key} panToFilter={filter} highlightFilter={highlightFilter} />\n            )\n        }\n\n        return result\n\n    }\n\n    m_countryLocations = {\n        \"Israel\": { \"lat\": 31.0461, \"lon\": 34.8516 },\n        \"Europe\": { \"lat\": 54.5260, \"lon\": 15.2551 },\n        \"China-Japan\": { \"lat\": 35.8617, \"lon\": 124.1954 }\n    }\n    panToCountry = (country) => {\n        console.log(country)\n        if (country !== undefined && country!==null) {\n            console.log(\"should pan to country: \" + country)\n\n            this.setState({\n                pointOfView: { \"lat\": this.m_countryLocations[country].lat, \"lon\": this.m_countryLocations[country].lon, \"altitude\": 1, \"ms\":1000 },\n                autoRotate:false\n            })\n        }  else {\n            this.setState({\n                pointOfView:null,\n                autoRotate:true\n            \n            })\n        }\n    }\n    highlightObjects(objects) {\n        //highlight countries on the globe\n        console.log(objects)\n        this.setState({\n            highlightCountries: objects\n        })\n    }\n    updateYears(min, max) {\n        //    console.log(\"update years: \" + min + \"   \" + max)\n        this.setState({\n            minYear: min,\n            maxYear: max\n        })\n    }\n    //capitalise the first letter of  string\n    cap(lower) {\n        return lower.replace(/^\\w/, c => c.toUpperCase());\n    }\n\n    render() {\n        return (\n            <div className=\"App\">\n\n                <div className=\"MainContainer\">\n                    <div className=\"navbar\" id=\"yearNav\">\n                        {this.state.sections.map(\n                            (section, i) =>\n                                <NavMenuItem\n                                    key={i}\n                                    id={i}\n                                    chapter={section.chapter}\n                                    name={section.title}\n                                    activeId={this.state.activeId}\n                                />\n                        )}\n                    </div>\n                    <div className=\"Panels topDistance\" style={{ height: this.state.panelHeight }}>\n\n                        {this.state.sections.map(\n                            (section, i) =>\n\n                                <StoryPanel\n                                    key={i}\n                                    id={i}\n                                    app={this}\n                                    activeID={this.state.activeId} //the Storypanels figure out if they are the active panel and display accordingly\n                                    title={section.title}\n                                    chapter={section.chapter}\n                                    paragraphs={section.renderparagraphs}\n                                />\n                        )}\n                    </div>\n\n                    <GlobeFunctions highlightCountries = {this.state.highlightCountries} autoRotate={this.state.autoRotate} pointOfView={this.state.pointOfView} width={parseInt(this.state.width / 2)} minYear={this.state.minYear} maxYear={this.state.maxYear} />\n\n                </div>\n                <h2 className=\"yearParagraph\">{this.state.minYear + \" - \" + this.state.maxYear}</h2>\n            </div>\n        );\n    }\n}\n\n\n\nconst NavMenuItem = ({ id, name, chapter, activeId }) => (\n\n    <ScrollIntoView\n        selector={`#chap_${chapter}`}\n        alignToTop={false} >\n        <div className={`navItem ${id === activeId ? \"navItemActive\" : \"\"} `}> {name} </div>\n    </ScrollIntoView>\n)\nconst { useState, useEffect, useRef } = React;\n\nlet lastPoint = null\nconst GlobeFunctions = ({ width, minYear, maxYear, pointOfView, autoRotate, highlightCountries}) => {\n\n    const [countries, setCountries] = useState({ features: [] });\n    const [hoverD, setHoverD] = useState();\n\n    const globeEl = useRef()\n\n    \n    useEffect(() => {\n        // load data\n        fetch(process.env.PUBLIC_URL + '/mergedMigrations.json').then(response => {\n            console.log(response);\n            return response.json();\n        }).then(setCountries);\n    }, []);\n\n\n    useEffect(() => {\n     //   console.log(pointOfView)\n        console.log(lastPoint)\n        if(pointOfView!==null)  {\n            if(lastPoint!==pointOfView){\n                globeEl.current.pointOfView({ lat: pointOfView.lat, lng: pointOfView.lon, altitude: pointOfView.altitude}, pointOfView.ms ) \n                globeEl.current.controls().autoRotate= false\n                lastPoint = pointOfView\n            }\n            \n        } else {\n            if(lastPoint !==null)\n                globeEl.current.pointOfView({ lat: lastPoint.lat, lng: lastPoint.lon, altitude: 2.5}, lastPoint.ms ) \n            globeEl.current.controls().autoRotate= true\n            lastPoint = null\n\n        }\n     //   console.log(pointOfView)\n       \n    })\n\n   \n    return <div className=\"globeContainer\">\n\n        <Globe\n            ref={globeEl}\n            width={width}\n            globeImageUrl=\"//unpkg.com/three-globe@2.11.1/example/img/earth-day.jpg\"\n            // backgroundImageUrl=\"//unpkg.com/three-globe/example/img/night-sky.png\"\n            backgroundColor=\"white\"\n            polygonsData={countries.features.filter(d => d.properties.ISO_A2 !== 'AQ')}\n            polygonAltitude={d =>  hasActivePolicyInYear(d.properties.migrationpolicies, minYear, maxYear) ? d===hoverD? 0.06 :  0.01 : 0.001}\n            polygonCapColor={d=>hasActivePolicyInYear(d.properties.migrationpolicies, minYear, maxYear) ?  highlightCountries.indexOf(d.properties.ADMIN) > -1 ? \"rgba(34,139,34,0.7)\" : \"rgba(219,112,147,0.7)\" : \"transparent\"}\n            polygonSideColor={() => 'rgba(0, 100, 0, 0.15)'}\n            polygonStrokeColor={d => hasActivePolicyInYear(d.properties.migrationpolicies, minYear, maxYear) ? '#111' : 'lightgrey'}\n            polygonLabel={({ properties: d }) => `\n        <div class=\"popup\"><b>${d.ADMIN} (${d.ISO_A2})</b> <br />\n        ${getPolicyText(d.migrationpolicies, minYear, maxYear)}\n        </div>\n      `}\n            onPolygonHover={setHoverD}\n            polygonsTransitionDuration={300}\n    \n    \n\n\n        />\n    </div>\n\n}\n\n/*Type of institution\":\"Ministry\",\"Institution Overview\"*/\n\nconst getPolicyText = (policies, minYear, maxYear) => {\n    if (policies) {\n        for (let i = 0; i < policies.length; i++) {\n            let start = policies[i][\"Year of establishment\"]\n            let end = policies[i][\"Year of disestablishment\"]\n            if (start !== \"Nil\" && start !== undefined && end !== undefined) {\n                if ((parseInt(start.substr(0, 4)) <= maxYear) && ((end === \"Nil\") || (parseInt(end.substr(0, 4)) > minYear))) {\n                    let str = \"<b>Institution Name:</b> \" + policies[i][\"Institution name\"] + \"<br />\"\n                    str += \"<b>Institution Overview:</b> \" + policies[i][\"Institution Overview\"] + \"<br />\"\n                    str += \"<b> Year of establishment: </b> \" + policies[i][\"Year of establishment\"] + \"<br />\"\n                    str += \"<b> Year of disestablishment: </b> \" + policies[i][\"Year of disestablishment\"] + \"<br />\"\n                    return str\n                }\n            }\n        }\n    }\n\n    return \"\"\n}\n/*\"Year of establishment\":\"1992\",\"Year of disestablishment\":\"1996\"*/\n\nconst hasActivePolicyInYear = (policies, minYear, maxYear) => {\n    //console.log(\"...\")\n    if (policies) {\n\n        for (let i = 0; i < policies.length; i++) {\n            let start = policies[i][\"Year of establishment\"]\n            let end = policies[i][\"Year of disestablishment\"]\n\n            if (start !== \"Nil\" && start !== undefined && end !== undefined) {\n\n                if ((parseInt(start.substr(0, 4)) <= maxYear) && ((end === \"Nil\") || (parseInt(end.substr(0, 4)) > minYear))) {\n       //             console.log(\"has active Policy\")\n                    return true\n                }\n            }\n        }\n    }\n    return false\n}\n\nReactDOM.render(<ScrollyTeller />, document.getElementById('root'));\n"],"sourceRoot":""}